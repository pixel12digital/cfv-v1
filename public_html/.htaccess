# Front Controller Pattern
RewriteEngine On
# RewriteBase removido - Apache detecta automaticamente baseado no DocumentRoot
# Em produção: DocumentRoot aponta para public_html/, então base é /
# Em local: DocumentRoot pode apontar para htdocs/, então base é /cfc-v.1/public_html/
# O Apache detecta automaticamente baseado em onde o .htaccess está localizado

# 1) Se o arquivo/pasta existe fisicamente, NÃO reescreve (servir diretamente)
RewriteCond %{REQUEST_FILENAME} -f [OR]
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule ^ - [L]

# 2) Atalho para assets (garantir que assets/ sempre seja servido diretamente)
RewriteRule ^assets/ - [L]

# 2.1) Permitir acesso direto ao pwa-manifest.php (PWA white-label)
RewriteRule ^pwa-manifest\.php$ - [L]

# 2.2) Permitir acesso direto ao sw.js e sw.php (Service Worker PWA)
RewriteRule ^sw\.(js|php)$ - [L]

# 2.3) Permitir acesso direto aos tools (scripts de diagnóstico)
RewriteRule ^tools/ - [L]

# 2.4) Permitir acesso direto ao diagnostico.php (script de diagnóstico)
RewriteRule ^diagnostico\.php$ - [L]

# 3) Front controller (só chega aqui se não for arquivo estático)
RewriteRule ^ index.php [L]

# Segurança
<FilesMatch "^\.">
    Order allow,deny
    Deny from all
</FilesMatch>

# Proteger storage
RewriteRule ^storage/ - [F,L]

# Headers de segurança
<IfModule mod_headers.c>
    Header set X-Content-Type-Options "nosniff"
    Header set X-Frame-Options "SAMEORIGIN"
    Header set X-XSS-Protection "1; mode=block"
</IfModule>
